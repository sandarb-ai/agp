{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aigp.sandarb.ai/schema/aigp-event.schema.json",
  "title": "AIGP Event",
  "description": "AI Governance Proof (AIGP) event schema v0.8.0 — an open specification for capturing cryptographic proof of every AI agent governance action. Includes OpenTelemetry integration fields for native distributed tracing correlation, Merkle tree governance hash for multi-resource verification, OpenLineage data lineage integration, memory governance, model identity tracking, event signing for non-repudiation, causal ordering for distributed agent pipelines, boundary events for ungoverned system visibility, and pointer pattern for large-content performance.",
  "type": "object",
  "required": [
    "event_id",
    "event_type",
    "event_category",
    "event_time",
    "agent_id",
    "governance_hash",
    "trace_id"
  ],
  "properties": {
    "event_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this event (UUID v4)."
    },
    "event_type": {
      "type": "string",
      "pattern": "^[A-Z][A-Z0-9_]*$",
      "description": "What happened. Uses UPPER_SNAKE_CASE RESOURCE_ACTION convention.",
      "examples": [
        "INJECT_SUCCESS",
        "INJECT_DENIED",
        "PROMPT_USED",
        "PROMPT_DENIED",
        "AGENT_REGISTERED",
        "AGENT_APPROVED",
        "AGENT_DEACTIVATED",
        "POLICY_CREATED",
        "POLICY_VERSION_APPROVED",
        "POLICY_ARCHIVED",
        "PROMPT_VERSION_CREATED",
        "PROMPT_VERSION_APPROVED",
        "GOVERNANCE_PROOF",
        "POLICY_VIOLATION",
        "A2A_CALL",
        "MEMORY_READ",
        "MEMORY_WRITTEN",
        "TOOL_INVOKED",
        "TOOL_DENIED",
        "CONTEXT_CAPTURED",
        "LINEAGE_SNAPSHOT",
        "INFERENCE_STARTED",
        "INFERENCE_COMPLETED",
        "INFERENCE_BLOCKED",
        "HUMAN_OVERRIDE",
        "HUMAN_APPROVAL",
        "CLASSIFICATION_CHANGED",
        "MODEL_LOADED",
        "MODEL_SWITCHED",
        "UNVERIFIED_BOUNDARY"
      ]
    },
    "event_category": {
      "type": "string",
      "description": "Event grouping (e.g. inject, audit, agent-lifecycle, policy-lifecycle, prompt-lifecycle, governance-proof, policy, memory, tool, context, lineage, inference, human, classification, model, boundary).",
      "examples": [
        "inject",
        "audit",
        "agent-lifecycle",
        "policy-lifecycle",
        "prompt-lifecycle",
        "governance-proof",
        "policy",
        "a2a",
        "memory",
        "tool",
        "context",
        "lineage",
        "inference",
        "human",
        "classification",
        "model",
        "boundary"
      ]
    },
    "event_time": {
      "type": "string",
      "format": "date-time",
      "description": "When the governance action occurred (UTC, ISO 8601, millisecond precision)."
    },

    "agent_id": {
      "type": "string",
      "description": "The agent that triggered this governance action. Should follow AGRN format: agent.<kebab-name>.",
      "examples": ["agent.trading-bot-v2", "agent.customer-support"]
    },
    "agent_name": {
      "type": "string",
      "description": "Human-readable agent name.",
      "default": ""
    },
    "org_id": {
      "type": "string",
      "description": "Organization the agent belongs to. Should follow AGRN format: org.<kebab-name>.",
      "default": "",
      "examples": ["org.finco", "org.acme-corp"]
    },
    "org_name": {
      "type": "string",
      "description": "Human-readable organization name.",
      "default": ""
    },

    "policy_id": {
      "type": "string",
      "description": "ID of the policy that was accessed or injected.",
      "default": ""
    },
    "policy_name": {
      "type": "string",
      "description": "Human-readable policy name. Should follow AGRN format: policy.<kebab-name>.",
      "default": "",
      "examples": ["policy.trading-limits", "policy.eu-refund-policy"]
    },
    "policy_version": {
      "type": "integer",
      "minimum": 0,
      "description": "Version of the policy at the time of this governance action. Point-in-time snapshot for audit.",
      "default": 0
    },
    "prompt_id": {
      "type": "string",
      "description": "ID of the prompt that was used.",
      "default": ""
    },
    "prompt_name": {
      "type": "string",
      "description": "Human-readable prompt name. Should follow AGRN format: prompt.<kebab-name>.",
      "default": "",
      "examples": ["prompt.customer-support-v3"]
    },
    "prompt_version": {
      "type": "integer",
      "minimum": 0,
      "description": "Version of the prompt at the time of this governance action. Point-in-time snapshot for audit.",
      "default": 0
    },

    "governance_hash": {
      "type": "string",
      "description": "SHA-256 hash of the governed content at the time of the action. This is the cryptographic proof. For single-resource events, this is a flat SHA-256 hash. For multi-resource events with Merkle tree (hash_type='merkle-sha256'), this is the Merkle root. Must be lowercase hexadecimal (64 characters) when present, or empty string for events without governed content.",
      "pattern": "^([a-f0-9]{64})?$"
    },
    "hash_type": {
      "type": "string",
      "description": "Hash algorithm used. 'sha256' for flat hash over single content, 'merkle-sha256' for Merkle tree root over multiple governed resources.",
      "default": "sha256",
      "examples": ["sha256", "sha384", "sha512", "merkle-sha256"]
    },
    "trace_id": {
      "type": "string",
      "description": "Distributed trace ID for end-to-end correlation. When integrating with OpenTelemetry, this SHOULD be the W3C Trace Context trace-id (32-character lowercase hexadecimal). Also accepts UUID v4 or prefixed format.",
      "examples": [
        "4bf92f3577b34da6a3ce929d0e0e4736",
        "550e8400-e29b-41d4-a716-446655440000",
        "trace-550e8400-e29b-41d4-a716-446655440000"
      ]
    },
    "span_id": {
      "type": "string",
      "pattern": "^([a-f0-9]{16})?$",
      "description": "OpenTelemetry span ID identifying the specific operation that produced this governance event. 16-character lowercase hexadecimal conforming to W3C Trace Context parent-id. OPTIONAL. When present, enables correlation between an AIGP event and a specific span within an OTel trace.",
      "default": "",
      "examples": ["00f067aa0ba902b7", "a1b2c3d4e5f6a7b8"]
    },
    "parent_span_id": {
      "type": "string",
      "pattern": "^([a-f0-9]{16})?$",
      "description": "OpenTelemetry parent span ID. 16-character lowercase hexadecimal. Enables AIGP events to participate in OTel span trees, connecting governance actions to the calling operation.",
      "default": "",
      "examples": ["00f067aa0ba902b7"]
    },
    "trace_flags": {
      "type": "string",
      "pattern": "^([a-f0-9]{2})?$",
      "description": "W3C Trace Context trace-flags. 2-character lowercase hexadecimal. '01' indicates the trace is sampled. Preserves OTel sampling decisions in governance records.",
      "default": "",
      "examples": ["01", "00"]
    },
    "data_classification": {
      "type": "string",
      "enum": ["public", "internal", "confidential", "restricted", ""],
      "description": "Classification of the data involved. Four-tier model: public, internal, confidential, restricted.",
      "default": ""
    },

    "template_rendered": {
      "type": "boolean",
      "description": "Whether the policy was rendered with variables before delivery.",
      "default": false
    },

    "denial_reason": {
      "type": "string",
      "description": "Why access was denied (human-readable). Present for DENIED events.",
      "default": ""
    },
    "violation_type": {
      "type": "string",
      "description": "Category of policy violation.",
      "default": ""
    },
    "severity": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low", ""],
      "description": "Impact level for denial and violation events.",
      "default": ""
    },

    "source_ip": {
      "type": "string",
      "description": "IP address of the requesting agent or service. May be omitted or anonymized for privacy.",
      "default": ""
    },
    "request_method": {
      "type": "string",
      "description": "HTTP method or protocol action that triggered the event.",
      "default": "",
      "examples": ["GET", "POST", "A2A", "MCP"]
    },
    "request_path": {
      "type": "string",
      "description": "API path or skill name.",
      "default": ""
    },

    "ingested_at": {
      "type": "string",
      "format": "date-time",
      "description": "When the event was received by the analytics store. Allows freshness measurement."
    },

    "annotations": {
      "type": "object",
      "description": "Informational context for the governance event. Annotations are NOT included in governance hashes and are NOT governed resources. Use for regulatory hooks, domain-specific tags, or supplementary context that does not require cryptographic proof. Consumers MUST ignore annotation keys they do not recognize.",
      "default": {},
      "additionalProperties": true
    },

    "query_hash": {
      "type": "string",
      "pattern": "^([a-f0-9]{64})?$",
      "description": "SHA-256 hash of a retrieval query. Used in MEMORY_READ events to prove what the agent asked for. Complements governance_hash (which proves what was returned).",
      "default": ""
    },
    "previous_hash": {
      "type": "string",
      "pattern": "^([a-f0-9]{64})?$",
      "description": "SHA-256 hash of the resource state before a write operation. Used in MEMORY_WRITTEN events to enable diff tracking of memory mutations, and in MODEL_SWITCHED events to record the prior model's identity.",
      "default": ""
    },

    "event_signature": {
      "type": "string",
      "description": "JWS Compact Serialization (RFC 7515) over the canonical event JSON (excluding signature fields). ES256 (ECDSA P-256) is mandatory-to-implement. Provides non-repudiation: proves WHO produced the governance proof. OPTIONAL — required for regulated environments (finserv, healthcare), not needed for internal governance.",
      "default": "",
      "examples": ["eyJhbGciOiJFUzI1NiJ9.eyJldmVudF9pZCI6Ii4uLiJ9.MEUCIQDx..."]
    },
    "signature_key_id": {
      "type": "string",
      "description": "AGRN-style identifier for the signing key. Enables key rotation and multi-agent key management. MUST be present when event_signature is non-empty.",
      "default": "",
      "examples": ["aigp:org.finco:agent.trading-bot-v2:2026-02"]
    },

    "sequence_number": {
      "type": "integer",
      "minimum": 0,
      "description": "Monotonically increasing counter scoped per (agent_id, trace_id). Provides causal ordering within a single agent's trace — event N happened after event N-1 regardless of clock skew. MUST NOT reset within a trace. Default 0 means unset.",
      "default": 0
    },
    "causality_ref": {
      "type": "string",
      "description": "Points to the event_id that causally precedes this event. Creates a DAG of causal dependencies across agents. Used for cross-agent ordering: Agent B's inference started because Agent A's A2A call completed.",
      "default": "",
      "examples": ["a1b2c3d4-e5f6-7890-abcd-ef1234567890"]
    },

    "spec_version": {
      "type": "string",
      "description": "The AIGP specification version the producer implemented. Consumers use this to determine which features and resource types to expect.",
      "default": "",
      "examples": ["0.8.0"]
    },

    "governance_merkle_tree": {
      "type": "object",
      "description": "Optional Merkle tree structure for multi-resource governance hash verification. Present when hash_type is 'merkle-sha256'. Each leaf represents one governed resource, enabling per-resource verification without possessing all resources. See Spec Section 8.8.",
      "properties": {
        "algorithm": {
          "type": "string",
          "description": "Hash algorithm used for leaf and internal node computation.",
          "default": "sha256",
          "examples": ["sha256"]
        },
        "leaf_count": {
          "type": "integer",
          "minimum": 2,
          "description": "Number of leaves in the Merkle tree. Must equal the length of the leaves array. Minimum 2 (single-resource events do not use Merkle trees)."
        },
        "leaves": {
          "type": "array",
          "description": "Leaf nodes sorted by hash value (lexicographic ascending). Each leaf represents one governed resource.",
          "minItems": 2,
          "items": {
            "type": "object",
            "required": ["resource_type", "resource_name", "hash"],
            "properties": {
              "resource_type": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$",
                "description": "Type of governed resource. Standard types: policy, prompt, tool, lineage, context, memory, model. Implementations MAY define custom types matching this pattern. Consumers MUST ignore resource types they do not recognize."
              },
              "resource_name": {
                "type": "string",
                "description": "AGRN-format name of the governed resource.",
                "examples": ["policy.trading-limits", "prompt.customer-support-v3", "tool.order-lookup", "context.upstream-lineage", "lineage.upstream-orders", "memory.conversation-history", "model.gpt4-trading-v2"]
              },
              "hash": {
                "type": "string",
                "pattern": "^[a-f0-9]{64}$",
                "description": "SHA-256 leaf hash: SHA-256(resource_type + ':' + resource_name + ':' + content)."
              },
              "hash_mode": {
                "type": "string",
                "enum": ["content", "pointer"],
                "description": "How the leaf hash was computed. 'content' (default): hash of raw content. 'pointer': hash of a content-addressable URI. When 'pointer', content_ref MUST be present.",
                "default": "content"
              },
              "content_ref": {
                "type": "string",
                "description": "When hash_mode is 'pointer', the URI of the immutable content blob (e.g., 's3://aigp-governance/sha256:abc123...'). The blob's object key is the SHA-256 of the content (self-verifying). MUST be present when hash_mode is 'pointer'.",
                "default": ""
              }
            },
            "additionalProperties": false
          }
        }
      },
      "required": ["algorithm", "leaf_count", "leaves"],
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
